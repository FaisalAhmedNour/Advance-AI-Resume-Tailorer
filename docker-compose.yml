name: resume-tailorer

networks:
  tailorer-net:
    driver: bridge

services:
  parser-api:
    build:
      context: services/parser-api
      dockerfile: Dockerfile
    image: resume-tailorer/parser-api:latest
    container_name: parser-api
    networks: [ tailorer-net ]
    ports: [ "3001:3001" ]
    environment:
      PORT: "3001"
      NODE_ENV: production
    healthcheck:
      test: [ "CMD-SHELL", "wget -qO- http://localhost:3001/health || exit 1" ]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  jd-analyzer-api:
    build:
      context: services/jd-analyzer-api
      dockerfile: Dockerfile
    image: resume-tailorer/jd-analyzer-api:latest
    container_name: jd-analyzer-api
    networks: [ tailorer-net ]
    ports: [ "3002:3002" ]
    environment:
      PORT: "3002"
      NODE_ENV: production
      GEMINI_API_KEY: ${GEMINI_KEY_ANALYZER}
    healthcheck:
      test: [ "CMD-SHELL", "wget -qO- http://localhost:3002/health || exit 1" ]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  rewrite-api:
    build:
      context: services/rewrite-api
      dockerfile: Dockerfile
    image: resume-tailorer/rewrite-api:latest
    container_name: rewrite-api
    networks: [ tailorer-net ]
    ports: [ "3003:3003" ]
    environment:
      PORT: "3003"
      NODE_ENV: production
      GEMINI_API_KEY: ${GEMINI_KEY_REWRITE}
    healthcheck:
      test: [ "CMD-SHELL", "wget -qO- http://localhost:3003/health || exit 1" ]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  scoring-api:
    build:
      context: services/scoring-api
      dockerfile: Dockerfile
    image: resume-tailorer/scoring-api:latest
    container_name: scoring-api
    networks: [ tailorer-net ]
    ports: [ "3004:3004" ]
    environment:
      PORT: "3004"
      NODE_ENV: production
    healthcheck:
      test: [ "CMD-SHELL", "wget -qO- http://localhost:3004/health || exit 1" ]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped
